name: Sync Secrets

on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Preview mode - no secrets will be written'
        required: false
        default: 'false'
        type: choice
        options:
          - 'false'
          - 'true'
  push:
    branches: [main]
    paths:
      - '.github/workflows/sync-secrets.yml'
  schedule:
    - cron: '0 6 * * 1'  # Weekly Monday 6am UTC - catches new repos

permissions:
  contents: read

jobs:
  sync-workflow-dispatch-token:
    name: "Sync GH_PAT_WORKFLOW_DISPATCH"
    runs-on: ubuntu-latest
    steps:
      - uses: jpoehnelt/secrets-sync-action@7840777f242539d96b60477b66aa1c179e7644ea
        with:
          SECRETS: |
            ^GH_PAT_WORKFLOW_DISPATCH$
          REPOSITORIES: |
            JacobPEvans/ai-assistant-instructions
            JacobPEvans/claude-code-plugins
            JacobPEvans/.github
          REPOSITORIES_LIST_REGEX: false
          DRY_RUN: ${{ inputs.dry_run || 'false' }}
          GITHUB_TOKEN: ${{ secrets.SECRETS_SYNC_PAT }}
        env:
          GH_PAT_WORKFLOW_DISPATCH: ${{ secrets.GH_PAT_WORKFLOW_DISPATCH }}

  sync-claude-oauth-token:
    name: "Sync CLAUDE_CODE_OAUTH_TOKEN"
    runs-on: ubuntu-latest
    steps:
      - uses: jpoehnelt/secrets-sync-action@7840777f242539d96b60477b66aa1c179e7644ea
        with:
          SECRETS: |
            ^CLAUDE_CODE_OAUTH_TOKEN$
          REPOSITORIES: |
            ^JacobPEvans/
          REPOSITORIES_LIST_REGEX: true
          DRY_RUN: ${{ inputs.dry_run || 'false' }}
          GITHUB_TOKEN: ${{ secrets.SECRETS_SYNC_PAT }}
        env:
          CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

  sync-pac-metrics-token:
    name: "Sync GH_PAC_METRICS_TOKEN"
    runs-on: ubuntu-latest
    steps:
      - uses: jpoehnelt/secrets-sync-action@7840777f242539d96b60477b66aa1c179e7644ea
        with:
          SECRETS: |
            ^GH_PAC_METRICS_TOKEN$
          REPOSITORIES: |
            JacobPEvans/JacobPEvans
          REPOSITORIES_LIST_REGEX: false
          DRY_RUN: ${{ inputs.dry_run || 'false' }}
          GITHUB_TOKEN: ${{ secrets.SECRETS_SYNC_PAT }}
        env:
          GH_PAC_METRICS_TOKEN: ${{ secrets.GH_PAC_METRICS_TOKEN }}
